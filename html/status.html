<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>Minisatip/$version$ on $http_host$</title>
	<link rel="stylesheet" type="text/css" href="jquery.dataTables.min.css">
	<style>
	body {
		padding: 5px;
	}
	body, td {
		font-family: Tahoma, Geneva, sans-serif;
		font-size: 0.9em;
	}
	th {
		font-family: Tahoma, Geneva, sans-serif;
		font-size: 1em;
	}
	.level {
		display: inline;
		white-space: nowrap;
		font-family: "Lucida Console", Monaco, monospace;
	}
	.noPadding {
		padding: 1px !important;
	}
	.strike {
		text-decoration: line-through;
		color: #eee !important;
	}
	table#myTable thead th {
		background-color: #aaa;
	}
	table.dataTable.no-footer {
		border-bottom: 1px solid #eee;
	}
	#pintervall {
		font-size: 14px;
		font-weight: 500;
		width: 28px;
		height: 18px;
		color: #000;
		background-color: transparent;
		border: none;
		border-radius: 4px;
		text-align: center;
		margin: 0 4px;
		padding: 0;
	}
	.polling {
		padding-bottom: 4px;
	}
	</style>

	<script type="text/javascript" language="javascript" src="jquery-1.12.0.min.js"></script>
	<script type="text/javascript" language="javascript" src="jquery.dataTables.min.js"></script>
	<script type="text/javascript" language="javascript" src="jquery.pBar.min.js"></script>
</head>

<body>
<div class="polling">Refresh:
<input type="text" id="pintervall" value="" readonly /> sec.
<button id="pdec">&minus;</button>
<button id="pstatus">PAUSE</button>
<button id="pinc">+</button>
</div>

<script type="text/javascript">
var ad_type		= [$ad_type0$, $ad_type1$, $ad_type2$, $ad_type3$, $ad_type4$, $ad_type5$, $ad_type6$, $ad_type7$, $ad_type8$, $ad_type9$, $ad_type10$, $ad_type11$, $ad_type12$, $ad_type13$, $ad_type14$, $ad_type15$ ];
var ad_enabled	= [$ad_enabled0$, $ad_enabled1$, $ad_enabled2$, $ad_enabled3$, $ad_enabled4$, $ad_enabled5$, $ad_enabled6$, $ad_enabled7$, $ad_enabled8$, $ad_enabled9$, $ad_enabled10$, $ad_enabled11$, $ad_enabled12$, $ad_enabled13$, $ad_enabled14$, $ad_enabled15$ ];
var ad_sys		= [$ad_sys0$, $ad_sys1$, $ad_sys2$, $ad_sys3$, $ad_sys4$, $ad_sys5$, $ad_sys6$, $ad_sys7$, $ad_sys8$, $ad_sys9$, $ad_sys10$, $ad_sys11$, $ad_sys12$, $ad_sys13$, $ad_sys14$, $ad_sys15$ ];
var ad_strength	= [$ad_strength0$, $ad_strength1$, $ad_strength2$, $ad_strength3$, $ad_strength4$, $ad_strength5$, $ad_strength6$, $ad_strength7$, $ad_strength8$, $ad_strength9$, $ad_strength10$, $ad_strength11$, $ad_strength12$, $ad_strength13$, $ad_strength14$, $ad_strength15$ ];
var ad_ber		= [$ad_ber0$, $ad_ber1$, $ad_ber2$, $ad_ber3$, $ad_ber4$, $ad_ber5$, $ad_ber6$, $ad_ber7$, $ad_ber8$, $ad_ber9$, $ad_ber10$, $ad_ber11$, $ad_ber12$, $ad_ber13$, $ad_ber14$, $ad_ber15$ ];
var ad_master	= [$ad_master0$, $ad_master1$, $ad_master2$, $ad_master3$, $ad_master4$, $ad_master5$, $ad_master6$, $ad_master7$, $ad_master8$, $ad_master9$, $ad_master10$, $ad_master11$, $ad_master12$, $ad_master13$, $ad_master14$, $ad_master15$ ];
var ad_freq		= [$ad_freq0$, $ad_freq1$, $ad_freq2$, $ad_freq3$, $ad_freq4$, $ad_freq5$, $ad_freq6$, $ad_freq7$, $ad_freq8$, $ad_freq9$, $ad_freq10$, $ad_freq11$, $ad_freq12$, $ad_freq13$, $ad_freq14$, $ad_freq15$ ];
var ad_pol		= [$ad_pol0$, $ad_pol1$, $ad_pol2$, $ad_pol3$, $ad_pol4$, $ad_pol5$, $ad_pol6$, $ad_pol7$, $ad_pol8$, $ad_pol9$, $ad_pol10$, $ad_pol11$, $ad_pol12$, $ad_pol13$, $ad_pol14$, $ad_pol15$ ];
var ad_sr		= [$ad_sr0$, $ad_sr1$, $ad_sr2$, $ad_sr3$, $ad_sr4$, $ad_sr5$, $ad_sr6$, $ad_sr7$, $ad_sr8$, $ad_sr9$, $ad_sr10$, $ad_sr11$, $ad_sr12$, $ad_sr13$, $ad_sr14$, $ad_sr15$ ];
var ad_bw		= [$ad_bw0$, $ad_bw1$, $ad_bw2$, $ad_bw3$, $ad_bw4$, $ad_bw5$, $ad_bw6$, $ad_bw7$, $ad_bw8$, $ad_bw9$, $ad_bw10$, $ad_bw11$, $ad_bw12$, $ad_bw13$, $ad_bw14$, $ad_bw15$ ];
var ad_diseqc	= [$ad_diseqc0$, $ad_diseqc1$, $ad_diseqc2$, $ad_diseqc3$, $ad_diseqc4$, $ad_diseqc5$, $ad_diseqc6$, $ad_diseqc7$, $ad_diseqc8$, $ad_diseqc9$, $ad_diseqc10$, $ad_diseqc11$, $ad_diseqc12$, $ad_diseqc13$, $ad_diseqc14$, $ad_diseqc15$ ];
var ad_snr		= [$ad_snr0$, $ad_snr1$, $ad_snr2$, $ad_snr3$, $ad_snr4$, $ad_snr5$, $ad_snr6$, $ad_snr7$, $ad_snr8$, $ad_snr9$, $ad_snr10$, $ad_snr11$, $ad_snr12$, $ad_snr13$, $ad_snr14$, $ad_snr15$ ];
var ad_phyad	= [$ad_phyad0$, $ad_phyad1$, $ad_phyad2$, $ad_phyad3$, $ad_phyad4$, $ad_phyad5$, $ad_phyad6$, $ad_phyad7$, $ad_phyad8$, $ad_phyad9$, $ad_phyad10$, $ad_phyad11$, $ad_phyad12$, $ad_phyad13$, $ad_phyad14$, $ad_phyad15$ ];
var ad_phyfd	= [$ad_phyfd0$, $ad_phyfd1$, $ad_phyfd2$, $ad_phyfd3$, $ad_phyfd4$, $ad_phyfd5$, $ad_phyfd6$, $ad_phyfd7$, $ad_phyfd8$, $ad_phyfd9$, $ad_phyfd10$, $ad_phyfd11$, $ad_phyfd12$, $ad_phyfd13$, $ad_phyfd14$, $ad_phyfd15$ ];
var ad_allsys	= ["$ad_allsys0$", "$ad_allsys1$", "$ad_allsys2$", "$ad_allsys3$", "$ad_allsys4$", "$ad_allsys5$", "$ad_allsys6$", "$ad_allsys7$", "$ad_allsys8$", "$ad_allsys9$", "$ad_allsys10$", "$ad_allsys11$", "$ad_allsys12$", "$ad_allsys13$", "$ad_allsys14$", "$ad_allsys15$" ];
var ad_pids		= ["$ad_pids0$", "$ad_pids1$", "$ad_pids2$", "$ad_pids3$", "$ad_pids4$", "$ad_pids5$", "$ad_pids6$", "$ad_pids7$", "$ad_pids8$", "$ad_pids9$", "$ad_pids10$", "$ad_pids11$", "$ad_pids12$", "$ad_pids13$", "$ad_pids14$", "$ad_pids15$" ];
var ad_satip	= ["$ad_satip0$", "$ad_satip1$", "$ad_satip2$", "$ad_satip3$", "$ad_satip4$", "$ad_satip5$", "$ad_satip6$", "$ad_satip7$", "$ad_satip8$", "$ad_satip9$", "$ad_satip10$", "$ad_satip11$", "$ad_satip12$", "$ad_satip13$", "$ad_satip14$", "$ad_satip15$" ];
var ad_axe_pktc = [$ad_axe_pktc0$, $ad_axe_pktc1$, $ad_axe_pktc2$, $ad_axe_pktc3$];
var ad_axe_ccerr = [$ad_axe_ccerr0$, $ad_axe_ccerr1$, $ad_axe_ccerr2$, $ad_axe_ccerr3$];
var ad_axe_coax = ["$ad_axe_coax0$", "$ad_axe_coax1$", "$ad_axe_coax2$", "$ad_axe_coax3$"];
var st_enabled	= [$st_enabled0$, $st_enabled1$, $st_enabled2$, $st_enabled3$, $st_enabled4$, $st_enabled5$, $st_enabled6$, $st_enabled7$, $st_enabled8$, $st_enabled9$, $st_enabled10$, $st_enabled11$, $st_enabled12$, $st_enabled13$, $st_enabled14$, $st_enabled15$ ];
var st_adapter	= [$st_adapter0$, $st_adapter1$, $st_adapter2$, $st_adapter3$, $st_adapter4$, $st_adapter5$, $st_adapter6$, $st_adapter7$, $st_adapter8$, $st_adapter9$, $st_adapter10$, $st_adapter11$, $st_adapter12$, $st_adapter13$, $st_adapter14$, $st_adapter15$ ];
var st_rport	= [$st_rport0$, $st_rport1$, $st_rport2$, $st_rport3$, $st_rport4$, $st_rport5$, $st_rport6$, $st_rport7$, $st_rport8$, $st_rport9$, $st_rport10$, $st_rport11$, $st_rport12$, $st_rport13$, $st_rport14$, $st_rport15$ ];
var st_rhost	= ["$st_rhost0$", "$st_rhost1$", "$st_rhost2$", "$st_rhost3$", "$st_rhost4$", "$st_rhost5$", "$st_rhost6$", "$st_rhost7$", "$st_rhost8$", "$st_rhost9$", "$st_rhost10$", "$st_rhost11$", "$st_rhost12$", "$st_rhost13$", "$st_rhost14$", "$st_rhost15$" ];
var st_pids		= ["$st_pids0$", "$st_pids1$", "$st_pids2$", "$st_pids3$", "$st_pids4$", "$st_pids5$", "$st_pids6$", "$st_pids7$", "$st_pids8$", "$st_pids9$", "$st_pids10$", "$st_pids11$", "$st_pids12$", "$st_pids13$", "$st_pids14$", "$st_pids15$" ];
var st_useragent = ["$st_useragent0$", "$st_useragent1$", "$st_useragent2$", "$st_useragent3$", "$st_useragent4$", "$st_useragent5$", "$st_useragent6$", "$st_useragent7$", "$st_useragent8$", "$st_useragent9$", "$st_useragent10$", "$st_useragent11$", "$st_useragent12$", "$st_useragent13$", "$st_useragent14$", "$st_useragent15$" ];
var st_play		= [$st_play0$, $st_play1$, $st_play2$, $st_play3$, $st_play4$, $st_play5$, $st_play6$, $st_play7$, $st_play8$, $st_play9$, $st_play10$, $st_play11$, $st_play12$, $st_play13$, $st_play14$, $st_play15$ ];
var key_enabled	= [$key_enabled0$, $key_enabled1$, $key_enabled2$, $key_enabled3$, $key_enabled4$, $key_enabled5$, $key_enabled6$, $key_enabled7$, $key_enabled8$, $key_enabled9$, $key_enabled10$, $key_enabled11$, $key_enabled12$, $key_enabled13$, $key_enabled14$, $key_enabled15$ ];
var key_hops	= [$key_hops0$, $key_hops1$, $key_hops2$, $key_hops3$, $key_hops4$, $key_hops5$, $key_hops6$, $key_hops7$, $key_hops8$, $key_hops9$, $key_hops10$, $key_hops11$, $key_hops12$, $key_hops13$, $key_hops14$, $key_hops15$ ];
var key_adapter	= [$key_adapter0$, $key_adapter1$, $key_adapter2$, $key_adapter3$, $key_adapter4$, $key_adapter5$, $key_adapter6$, $key_adapter7$, $key_adapter8$, $key_adapter9$, $key_adapter10$, $key_adapter11$, $key_adapter12$, $key_adapter13$, $key_adapter14$, $key_adapter15$ ];
var key_pmt	= [$key_pmt0$, $key_pmt1$, $key_pmt2$, $key_pmt3$, $key_pmt4$, $key_pmt5$, $key_pmt6$, $key_pmt7$, $key_pmt8$, $key_pmt9$, $key_pmt10$, $key_pmt11$, $key_pmt12$, $key_pmt13$, $key_pmt14$, $key_pmt15$ ];
var key_ecmtime	= [$key_ecmtime0$, $key_ecmtime1$, $key_ecmtime2$, $key_ecmtime3$, $key_ecmtime4$, $key_ecmtime5$, $key_ecmtime6$, $key_ecmtime7$, $key_ecmtime8$, $key_ecmtime9$, $key_ecmtime10$, $key_ecmtime11$, $key_ecmtime12$, $key_ecmtime13$, $key_ecmtime14$, $key_ecmtime15$ ];
var key_cardsystem = ["$key_cardsystem0$", "$key_cardsystem1$", "$key_cardsystem2$", "$key_cardsystem3$", "$key_cardsystem4$", "$key_cardsystem5$", "$key_cardsystem6$", "$key_cardsystem7$", "$key_cardsystem8$", "$key_cardsystem9$", "$key_cardsystem10$", "$key_cardsystem11$", "$key_cardsystem12$", "$key_cardsystem13$", "$key_cardsystem14$", "$key_cardsystem15$" ];
var key_reader	= ["$key_reader0$", "$key_reader1$", "$key_reader2$", "$key_reader3$", "$key_reader4$", "$key_reader5$", "$key_reader6$", "$key_reader7$", "$key_reader8$", "$key_reader9$", "$key_reader10$", "$key_reader11$", "$key_reader12$", "$key_reader13$", "$key_reader14$", "$key_reader15$" ];
var key_from	= ["$key_from0$", "$key_from1$", "$key_from2$", "$key_from3$", "$key_from4$", "$key_from5$", "$key_from6$", "$key_from7$", "$key_from8$", "$key_from9$", "$key_from10$", "$key_from11$", "$key_from12$", "$key_from13$", "$key_from14$", "$key_from15$" ];
var key_protocol = ["$key_protocol0$", "$key_protocol1$", "$key_protocol2$", "$key_protocol3$", "$key_protocol4$", "$key_protocol5$", "$key_protocol6$", "$key_protocol7$", "$key_protocol8$", "$key_protocol9$", "$key_protocol10$", "$key_protocol11$", "$key_protocol12$", "$key_protocol13$", "$key_protocol14$", "$key_protocol15$" ];

var max_adapters = 16;
var max_streams	= 64;
var max_keys 	= 255;
var pol			= ["", "(V)", "(H)", "(R)", "(L)"];
var sys			= [ "", "dvbc", "dvbcb", "dvbt", "dss", "dvbs", "dvbs2", "dvbh", "isdbt", "isdbs", "isdbc", "atsc", "atscmh", "dmbth", "cmmb", "dab", "dvbt2", "turbo", "dvbcc", "dvbc2" ];

var myTable = "<table id='myTable' class='display cell-border compact' cellspacing='0' width='100%'>";
myTable += "<thead><tr><th>Tuner</th>";
myTable += "<th class=''>Status</th>";
myTable += "<th class='dt-right'>Frequency</th>";
myTable += "<th class='dt-right'>SR/BW</th>";
myTable += "<th class='dt-right'>Signal</th>";
myTable += "<th class='dt-right'>Packets</th>";
myTable += "<th class='dt-right'>CC Errors</th>";
myTable += "<th class='dt-right'>Coax Cable</th>";
myTable += "<th class='dt-left'>Streams</th>";
myTable += "<th class='dt-left'>Cryptinfo</th>";
myTable += "</tr></thead><tbody>";

for (var i = 0; i < max_adapters; i++) {
	if (ad_type[i] == 0)
		continue;
	
	if (ad_enabled[i] == 1)
		myTable += "<tr valign='top'>";
	else	
		myTable += "<tr style='opacity: 0.5;'>";
	
	// TUNER
	myTable += "<td class='dt-right'>" + i + "</td>";
	
	// STATUS
	var csys = "";
	if (ad_sys[i] == 0)
		csys = ad_allsys[i];
	else
		csys = sys[ad_sys[i]];
	
	if (ad_enabled[i] == 1)
		myTable += "<td class='dt-right enabled'><img src='" + csys + ".png' title='" + csys + "' /><br />";
	else
		myTable += "<td class='dt-right disabled'>" + ad_allsys[i];
	
	if (ad_type[i] == 1 || ad_type[i] == 3) {
		// myTable += "<small>(" + ad_phyad[i] + "," + ad_phyfd[i] +")</small>";
	} else { 
		myTable += "<small>(" + ad_satip[i] + ")</small>";
	}
	myTable += "</td>";
	
	// FREQUENCY
	myTable += "<td class='dt-right'>" + ad_freq[i] + " "+pol[ad_pol[i]]+"</td>";
	
	if (ad_sys[i] == 0 || ad_sys[i] == 1 || ad_sys[i] == 2 || ad_sys[i] == 5 || ad_sys[i] == 6 || ad_sys[i] == 18 || ad_sys[i] == 19 )
		myTable += "<td class='dt-right'>" + ad_sr[i] + "</td>";
	else 
		myTable += "<td class='dt-right'>" + ad_bw[i]/1000 + "MHZ</td>";
	
	// SIGNAL
	var signal = "";
	if (ad_enabled[i] == 0) {
		signal = "<small>OFFLINE</small>";
	} else {
		var s1 = parseInt(ad_strength[i] / 2.55);
		signal = "<div class='level'>STR <div class='pBar' data-from='"+ s1 + "' data-to='" + s1 + "'></div> " + s1 + "%</div><br />";

		var s2 = parseInt(ad_snr[i] / 0.15);
		signal += "<div class='level'>SNR <div class='pBar' data-from='"+ s2 + "' data-to='" + s2 + "'></div> " + s2 + "%</div><br />";

		if (ad_ber[i] > 0)
			signal += "<div class='level'>BER <div class='pBar' data-from='"+ ad_ber[i] + "' data-to='" + ad_ber[i] + "' data-color='red'></div> " + ad_ber[i] + "</div><br />";
	}
	myTable += "<td class='dt-right'>" + signal + " </td>";
	myTable += "<td class='dt-right'>" + ad_axe_pktc[i] + " </td>";
	myTable += "<td class='dt-right'>" + ad_axe_ccerr[i] + " </td>";
	myTable += "<td class='dt-right'>" + ad_axe_coax[i] + " </td>";

	// STREAMS
	myTable += "<td class='dt-left'>";
	for (var j = 0; j < max_streams; j++) {
		if (st_enabled[j] == 1 && st_adapter[j] == i) {
			var st_rh = st_rhost[j]+":"+st_rport[j];
			if (ad_master[i] == j)
				st_rh = "<b>"+st_rh+"</b>";
			if (st_play[j] == 0)
				st_rh = "<i>"+st_rh+"</i>";
			myTable += st_rh + "<br />";
			if (st_useragent[j] != "")
				myTable += "<small>Client: " + st_useragent[j] + "</small><br />";
		}
	}
	for (var j = 0; j < max_streams; j++) {
		if (st_enabled[j] == 1 && st_adapter[j] == i) {
			var st_p = st_pids[j];
			if (ad_master[i] == j)
				st_p = "" + st_p + "";
			if (st_play[j] == 0)
				st_p = "<i>" + st_p + "</i>";
			myTable += "<small>Pids: " + st_p + "</small><br />";
		}
	}
	myTable +="</td>";

	// CRYPT
	myTable +="<td class=''><small>";
	for (var j = 0; j < max_keys; j++)
		if (key_enabled[j] == 1 && key_adapter[j] == i) {
			myTable += "SYSTEM: " + key_cardsystem[j] + "<br />";
			myTable += "PMT: " + key_pmt[j] + "<br />";
			myTable += "ECMTIME: " + key_ecmtime[j] + "<br />";
			myTable += "READER: " + key_reader[j] + "<br />";
			myTable += "IP: " + key_from[j] + " (" + key_protocol[j] + ")<br /><br />";
		}
	myTable +="</small></td></tr>";
}
myTable+="</tbody></table>";


var pcurrent = 1;
var pvalues = [5, 10, 15, 30, 60, 300 ];
var prefresh;

var hashTag = location.hash;
if (typeof hashTag.split('#')[1] !== "undefined") {
	var temp = parseInt(hashTag.split('#')[1]);
	if (temp >= 0 && temp <= 5) {
		pcurrent = temp;
	}
}

function reloadPage() {	
	$("#pintervall").val( pvalues[pcurrent] );
	
	clearInterval(prefresh);
	
	prefresh = setInterval(function () {
		var url = location.origin + location.pathname + "#" + pcurrent;
		location.href = url;
		location.reload(true); // force reload
	}, pvalues[pcurrent] * 1000); 
}

$(document).ready(function() {
	console.log("minisatip status: " + Date());

	var el = document.createElement('div');
	el.innerHTML = myTable;
	document.body.appendChild(el);
	
	$('#myTable').DataTable({
		"paging":	false,
		"bFilter":	false,
		"ordering":	true,
		"info":		false,
		"columnDefs": [
			{ "width": "40px", "targets": 0 },
			{ "width": "40px", "targets": 1 },
			{ "width": "50px", "targets": 2 },
			{ "width": "50px", "targets": 3 },
			{ "width": "50px", "targets": 4 }
		],
		"aoColumnDefs": [
			{ "sClass": "noPadding", "aTargets": [ 1 ] }
		],
		"language": {
			"emptyTable": "No tuner found/active"
		}
	});
	
	$(".pBar").pBar();
	
	$("#pdec").click(function() {
		if (pcurrent > 0) {
			pcurrent = pcurrent - 1;
			reloadPage();
		}
	});
	
	$("#pinc").click(function() {
		if (pcurrent <= 4) {
			pcurrent = pcurrent + 1;
			reloadPage();
		}
	});
	
	$("#pstatus").click(function() {
		if ($("#pstatus").html() == "PAUSE") {
			clearInterval(prefresh);
			$("#pstatus").html("START");
			$("#pintervall").addClass("strike");
		} else {
			reloadPage();
			$("#pstatus").html("PAUSE");
			$("#pintervall").removeClass("strike");
		}
	});
	
	reloadPage();
});

</script>

</body>
</html>
